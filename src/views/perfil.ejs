<!DOCTYPE html>
<html lang="en">
<head>
   <%- include('partials/head'); %>
</head>

<body class="container">
    <header>
        <%- include('partials/headerAluno'); %>
    </header>

    <section id="user-info" class="container">
        <h2>Informações do Aluno</h2>
    
        <!-- Formulário começa aqui -->
        <form id="updateUserForm">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="nome" class="form-label">Nome:</label>
                        <input class="form-control" type="text" id="nome" name="nome" value="<%= usuario.nome %>">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="cpf" class="form-label">CPF:</label>
                        <input class="form-control" type="text" id="cpf" name="cpf" value="<%= usuario.cpf %>" readonly>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="matricula" class="form-label">Matrícula:</label>
                        <input class="form-control" type="text" id="matricula" name="matricula" value="<%= usuario.matricula %>" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email:</label>
                        <input class="form-control" type="email" id="email" name="email" value="<%= usuario.email %>">
                    </div>
                </div>
            </div>
        
            <div class="row">
                <div class="col-6">
                    <div class="mb-3">
                        <label for="telefone" class="form-label">Telefone:</label>
                        <input class="form-control" type="text" id="telefone" name="telefone" value="<%= usuario.telefone %>">
                    </div>
                </div>
                <div class="col-6">
                    <div class="mb-3">
                        <label for="senha" class="form-label">Senha:</label>
                        <input class="form-control" type="password" id="senha" name="senha" value="<%= usuario.senha %>">
                    </div>
                </div>
            </div> 
        
            <!-- Botão de envio -->
            <button type="submit" class="btn btn-primary">Salvar alterações</button>
        </form>
        <!-- Formulário termina aqui -->
    </section>

    <script>
        // Certifique-se de que o evento de submit é adicionado ao formulário
        document.getElementById('updateUserForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = {
                nome: document.getElementById('nome').value,
                cpf: document.getElementById('cpf').value,
                email: document.getElementById('email').value,
                telefone: document.getElementById('telefone').value,
                senha: document.getElementById('senha').value,
                matricula: document.getElementById('matricula').value
            };

            const userId = "<%= usuario.idUsuario %>";

            fetch(`/api/usuario/${userId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro na atualização do usuário.');
                }
                return response.json();
            })
            .then(data => {
                alert(data.message || 'Usuário atualizado com sucesso!');
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao atualizar usuário.');
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
</body>
</html>
