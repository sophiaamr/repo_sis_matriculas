<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head'); %>
    <title>Formulário de Matrícula</title>
    <style>
        .navbar-nav .nav-link {
            color: white;
            font-size: 1rem;
        }

        .navbar-nav .nav-link:hover {
            color: #e9ecef;
        }

        .form-group {
            margin-bottom: 5px;
        }

        .form-group label {
            font-weight: bold;
        }

        .form-group select, 
        .form-group input[type="checkbox"] {
            margin-right: 10px;
        }

        .disciplinas-container {
            display: flex;
            flex-direction: column;
        }

        .disciplinas-container p {
            margin: 0;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .disciplinas-container input[type="checkbox"] {
            margin-right: 10px;
        }

        .error {
            color: red;
            font-size: 0.9em;
        }

        .btn-custom {
            background-color: rgb(115, 115, 141);
            border-color: rgb(115, 115, 141);
            color: #ffffff;
            width: 100%;
        }

        .btn-custom:hover {
            background-color: rgb(115, 115, 141);
            border-color: rgb(115, 115, 141);
        }
    </style>
</head>

<body class="container">
    <header>
        <%- include('partials/headerAluno'); %>
    </header>

    <main>
        <section>
            <h3>Formulário de Matrícula</h3>
            <form id="matriculaForm" action="/api/matricula" method="POST">
                <!-- Seleção do Curso -->
                <div class="form-group">
                    <label for="idCurso">Selecione o Curso:</label>
                    <select id="idCurso" name="idCurso" class="form-select" required>
                        <option value="">Selecione um curso</option>
                        <% cursos.forEach(curso => { %>
                            <option value="<%= curso.idCurso %>"><%= curso.nome %></option>
                        <% }) %>
                    </select>
                </div>

                <!-- Seleção do Período -->
                <div class="form-group">
                    <label for="periodo">Selecione o Período:</label>
                    <select id="periodo" name="periodo" class="form-select" required>
                        <!-- As opções de período serão adicionadas dinamicamente -->
                    </select>
                </div>

                <!-- Disciplinas Obrigatórias -->
                <div class="form-group">
                    <label>Selecione as Disciplinas Obrigatórias:</label>
                    <div class="disciplinas-container" id="disciplinasObrigatorias">
                        <!-- Disciplinas obrigatórias serão carregadas aqui -->
                    </div>
                    <div id="obrigatoriaError" class="error"></div>
                </div>

                <!-- Disciplinas Optativas -->
                <div class="form-group">
                    <label>Selecione as Disciplinas Optativas:</label>
                    <div class="disciplinas-container" id="disciplinasOptativas">
                        <!-- Disciplinas optativas serão carregadas aqui -->
                    </div>
                    <div id="optativaError" class="error"></div>
                </div>

                <button type="submit" class="btn btn-custom">Enviar</button>
            </form>
            
            <script>
               const cursos = <%- JSON.stringify(cursos) %>;
                const disciplinas = <%- JSON.stringify(disciplinas) %>;
                /*
                const disciplinas = [
        { idDisciplina: 1, nomeDisciplina: "Matemática", valor: 200, status: "Ativa", qntdAluno: 30, idCurso: 1, periodo: 1, numCredito: 2 },
        { idDisciplina: 2, nomeDisciplina: "História", valor: 150, status: "Ativa", qntdAluno: 25, idCurso: 1, periodo: 1, numCredito: 1 },
        { idDisciplina: 3, nomeDisciplina: "Física", valor: 220, status: "Cheia", qntdAluno: 28, idCurso: 1, periodo: 2, numCredito: 2 },
        { idDisciplina: 4, nomeDisciplina: "Química", valor: 180, status: "Ativa", qntdAluno: 20, idCurso: 1, periodo: 2, numCredito: 2 },
        { idDisciplina: 5, nomeDisciplina: "Biologia", valor: 170, status: "Ativa", qntdAluno: 22, idCurso: 1, periodo: 2, numCredito: 1 },
    ];
                */
               

                // Atualiza o período com base na seleção do curso
                document.getElementById('idCurso').addEventListener('change', function(event) {
                    const cursoId = event.target.value;
                    const curso = cursos.find(c => c.idCurso == cursoId);

                    let selectPeriodo = document.getElementById('periodo');

                    selectPeriodo.innerHTML = '<option value="">Selecione o período</option>';

                    if (curso) {
                        for (let index = 1; index <= curso.periodo; index++) {
                           selectPeriodo.innerHTML += `<option value="${index}">Período ${index}</option>`;
                        }
                    }
                });

                 
// Função para carregar disciplinas com base no curso e no período
document.getElementById('periodo').addEventListener('change', function(event) {
        const cursoId = document.getElementById('idCurso').value;
        const periodo = event.target.value;

        // Filtrar disciplinas com base no curso e no período
        const disciplinasFiltradas = disciplinas.filter(d => 
            d.idCurso == cursoId && 
            d.periodo == periodo && 
            d.status === 'Ativa'
        );

        // Limpar contêineres de disciplinas antes de adicionar novas
        const containerObrigatorias = document.getElementById('disciplinasObrigatorias');
        const containerOptativas = document.getElementById('disciplinasOptativas');
        containerObrigatorias.innerHTML = '';
        containerOptativas.innerHTML = '';

        // Adicionar disciplinas filtradas aos respectivos contêineres
        let obrigatoriasCount = 0;
        let optativasCount = 0;

        disciplinasFiltradas.forEach(disciplina => {
            if (disciplina.numCredito === 2 && obrigatoriasCount < 4) {
                // Adicionar disciplina obrigatória
                const disciplinaElement = document.createElement('p');
                disciplinaElement.innerHTML = `
                    <input type="checkbox" name="disciplinas" value="${disciplina.idDisciplina}" />
                    ${disciplina.nomeDisciplina} - Créditos: ${disciplina.numCredito}
                `;
                containerObrigatorias.appendChild(disciplinaElement);
                obrigatoriasCount++;
            } else if (disciplina.numCredito === 1 && optativasCount < 2) {
                // Adicionar disciplina optativa
                const disciplinaElement = document.createElement('p');
                disciplinaElement.innerHTML = `
                    <input type="checkbox" name="disciplinas" value="${disciplina.idDisciplina}" />
                    ${disciplina.nomeDisciplina} - Créditos: ${disciplina.numCredito}
                `;
                containerOptativas.appendChild(disciplinaElement);
                optativasCount++;
            }
        });

        // Exibir mensagens de erro se não houver disciplinas
        document.getElementById('obrigatoriaError').innerText = containerObrigatorias.children.length === 0 ? 'Nenhuma disciplina obrigatória disponível.' : '';
        document.getElementById('optativaError').innerText = containerOptativas.children.length === 0 ? 'Nenhuma disciplina optativa disponível.' : '';
    });
            </script>
        </section>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    </main>
</body>
</html>
