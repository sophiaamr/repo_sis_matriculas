<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('partials/head'); %>
        <style>
            .form-section {
                padding: 20px;
            }

            .hidden {
                display: none;
            }
        </style>
</head>



<body class="container">
    <header>
        <%- include('partials/headerSecretaria'); %>
    </header>
    <section class="form-section">
        <div class="container">
            <h2>Cadastro de Disciplina</h2>

            

            <hr class="my-2">
            <form id="disciplinaForm">
                <div class="mb-1">
                    <label for="nomeDisciplina" class="form-label">Nome da Disciplina</label>
                    <input type="text" class="form-control" id="nomeDisciplina" name="nomeDisciplina" required>
                </div>
                <div class="mb-1">
                    <label for="valor" class="form-label">Valor</label>
                    <input type="number" class="form-control" id="valor" name="valor" required>
                </div>
                <div class="mb-1">
                    <label for="status" class="form-label">Status</label>
                    <select class="form-select" id="status" name="status" required>
                        <option value="" disabled selected>Selecione o status</option>
                        <option value="ativa">Ativa</option>
                        <option value="inativa">Inativa</option>
                    </select>
                </div>
                <div class="mb-1">
                    <label for="qntdAluno" class="form-label">Número de Alunos</label>
                    <input type="number" class="form-control" id="qntdAluno" name="qntdAluno" required>
                </div>
                <div class="mb-1">
                    <label for="idCurso" class="form-label">ID do Curso</label>
                    <input type="text" class="form-control" id="idCurso" name="idCurso" required>
                </div>
                <div class="mb-1">
                    <label for="periodo" class="form-label">Período</label>
                    <select class="form-select" id="periodo" name="periodo" required>
                        <option value="" disabled selected>Selecione o período</option>
                        <% for (let i=1; i <=8; i++) { %>
                            <option value="<%= i %>">
                                <%= i %>° período
                            </option>
                            <% } %>
                    </select>
                </div>
                <div class="mb-1">
                    <label for="numCredito" class="form-label">Número de Créditos</label>
                    <select class="form-select" id="numCredito" name="numCredito" required>
                        <option value="" disabled selected>Selecione o número de créditos</option>
                        <option value="1">1 crédito</option>
                        <option value="2">2 créditos</option>
                    </select>
                </div>

                <button type="submit" id="submitBtn" class="btn btn-primary"
                    style="width: 100%;background-color:rgb(115, 115, 141);border-color:rgb(115, 115, 141); margin-top: 10px;">
                    Cadastrar Disciplina
                </button>
            </form>
        </div>


        

    </section>

    <script>
        document.getElementById('disciplinaForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Impede o comportamento padrão de envio do formulário
    
            // Captura os valores dos campos do formulário
            const nomeDisciplina = document.getElementById('nomeDisciplina').value;
            const valor = document.getElementById('valor').value;
            const status = document.getElementById('status').value;
            const qntdAluno = document.getElementById('qntdAluno').value; // Alterei de 'qntdAluno' para 'numAlunos' para combinar com o ID do campo
            const idCurso = document.getElementById('idCurso').value;
            const periodo = document.getElementById('periodo').value;
            const numCredito = document.getElementById('numCredito').value;
    
            // Verificação simples para garantir que todos os campos estão preenchidos
            if (!nomeDisciplina || !valor || !status || !qntdAluno || !idCurso || !periodo || !numCredito) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
    
            // Cria o objeto com os dados do formulário
            const disciplinaData = {
                nomeDisciplina: nomeDisciplina,
                valor: valor,
                status: status,
                qntdAluno: qntdAluno,
                idCurso: idCurso,
                periodo: periodo,
                numCredito: numCredito
            };
    
            // Faz o fetch para enviar os dados ao servidor
            fetch('/api/disciplinas/cadastrarDisciplinas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(disciplinaData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao cadastrar disciplina: ' + response.statusText);
                }
                return response.json();
            })
            .then(result => {
                if (result.success) {
                    alert('Disciplina cadastrada com sucesso!');
                    document.getElementById('disciplinaForm').reset(); // Limpa o formulário após o cadastro
                } else {
                    alert('Erro ao cadastrar disciplina: ' + result.message);
                }
            })
            .catch(error => {
                console.error('Erro ao processar o cadastro da disciplina:', error);
                alert('Erro ao processar o cadastro da disciplina: ' + error.message);
            });
        });
    </script>
    

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
</body>

</html>